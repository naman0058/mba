{"ast":null,"code":"// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nimport { generateUuid } from \"@azure/core-http\";\nimport { StorageClientContext } from \"./generated/src/index\";\nimport { SpanStatusCode } from \"@azure/core-tracing\";\nimport { Blob as StorageBlob, Container } from \"./generated/src/operations\";\nimport { ETagNone } from \"./utils/constants\";\nimport { convertTracingToRequestOptionsBase, createSpan } from \"./utils/tracing\";\n/**\n * A client that manages leases for a {@link ContainerClient} or a {@link BlobClient}.\n */\n\nexport class BlobLeaseClient {\n  /**\n   * Creates an instance of BlobLeaseClient.\n   * @param client - The client to make the lease operation requests.\n   * @param leaseId - Initial proposed lease id.\n   */\n  constructor(client, leaseId) {\n    const clientContext = new StorageClientContext(client.url, client.pipeline.toServiceClientOptions());\n    this._url = client.url;\n\n    if (client.name === undefined) {\n      this._isContainer = true;\n      this._containerOrBlobOperation = new Container(clientContext);\n    } else {\n      this._isContainer = false;\n      this._containerOrBlobOperation = new StorageBlob(clientContext);\n    }\n\n    if (!leaseId) {\n      leaseId = generateUuid();\n    }\n\n    this._leaseId = leaseId;\n  }\n  /**\n   * Gets the lease Id.\n   *\n   * @readonly\n   */\n\n\n  get leaseId() {\n    return this._leaseId;\n  }\n  /**\n   * Gets the url.\n   *\n   * @readonly\n   */\n\n\n  get url() {\n    return this._url;\n  }\n  /**\n   * Establishes and manages a lock on a container for delete operations, or on a blob\n   * for write and delete operations.\n   * The lock duration can be 15 to 60 seconds, or can be infinite.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param duration - Must be between 15 to 60 seconds, or infinite (-1)\n   * @param options - option to configure lease management operations.\n   * @returns Response data for acquire lease operation.\n   */\n\n\n  async acquireLease(duration) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var _a, _b, _c, _d, _e, _f;\n\n    const {\n      span,\n      updatedOptions\n    } = createSpan(\"BlobLeaseClient-acquireLease\", options);\n\n    if (this._isContainer && (((_a = options.conditions) === null || _a === void 0 ? void 0 : _a.ifMatch) && ((_b = options.conditions) === null || _b === void 0 ? void 0 : _b.ifMatch) !== ETagNone || ((_c = options.conditions) === null || _c === void 0 ? void 0 : _c.ifNoneMatch) && ((_d = options.conditions) === null || _d === void 0 ? void 0 : _d.ifNoneMatch) !== ETagNone || ((_e = options.conditions) === null || _e === void 0 ? void 0 : _e.tagConditions))) {\n      throw new RangeError(\"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\");\n    }\n\n    try {\n      return await this._containerOrBlobOperation.acquireLease(Object.assign({\n        abortSignal: options.abortSignal,\n        duration,\n        modifiedAccessConditions: Object.assign(Object.assign({}, options.conditions), {\n          ifTags: (_f = options.conditions) === null || _f === void 0 ? void 0 : _f.tagConditions\n        }),\n        proposedLeaseId: this._leaseId\n      }, convertTracingToRequestOptionsBase(updatedOptions)));\n    } catch (e) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n  /**\n   * To change the ID of the lease.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param proposedLeaseId - the proposed new lease Id.\n   * @param options - option to configure lease management operations.\n   * @returns Response data for change lease operation.\n   */\n\n\n  async changeLease(proposedLeaseId) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var _a, _b, _c, _d, _e, _f;\n\n    const {\n      span,\n      updatedOptions\n    } = createSpan(\"BlobLeaseClient-changeLease\", options);\n\n    if (this._isContainer && (((_a = options.conditions) === null || _a === void 0 ? void 0 : _a.ifMatch) && ((_b = options.conditions) === null || _b === void 0 ? void 0 : _b.ifMatch) !== ETagNone || ((_c = options.conditions) === null || _c === void 0 ? void 0 : _c.ifNoneMatch) && ((_d = options.conditions) === null || _d === void 0 ? void 0 : _d.ifNoneMatch) !== ETagNone || ((_e = options.conditions) === null || _e === void 0 ? void 0 : _e.tagConditions))) {\n      throw new RangeError(\"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\");\n    }\n\n    try {\n      const response = await this._containerOrBlobOperation.changeLease(this._leaseId, proposedLeaseId, Object.assign({\n        abortSignal: options.abortSignal,\n        modifiedAccessConditions: Object.assign(Object.assign({}, options.conditions), {\n          ifTags: (_f = options.conditions) === null || _f === void 0 ? void 0 : _f.tagConditions\n        })\n      }, convertTracingToRequestOptionsBase(updatedOptions)));\n      this._leaseId = proposedLeaseId;\n      return response;\n    } catch (e) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n  /**\n   * To free the lease if it is no longer needed so that another client may\n   * immediately acquire a lease against the container or the blob.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param options - option to configure lease management operations.\n   * @returns Response data for release lease operation.\n   */\n\n\n  async releaseLease() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    var _a, _b, _c, _d, _e, _f;\n\n    const {\n      span,\n      updatedOptions\n    } = createSpan(\"BlobLeaseClient-releaseLease\", options);\n\n    if (this._isContainer && (((_a = options.conditions) === null || _a === void 0 ? void 0 : _a.ifMatch) && ((_b = options.conditions) === null || _b === void 0 ? void 0 : _b.ifMatch) !== ETagNone || ((_c = options.conditions) === null || _c === void 0 ? void 0 : _c.ifNoneMatch) && ((_d = options.conditions) === null || _d === void 0 ? void 0 : _d.ifNoneMatch) !== ETagNone || ((_e = options.conditions) === null || _e === void 0 ? void 0 : _e.tagConditions))) {\n      throw new RangeError(\"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\");\n    }\n\n    try {\n      return await this._containerOrBlobOperation.releaseLease(this._leaseId, Object.assign({\n        abortSignal: options.abortSignal,\n        modifiedAccessConditions: Object.assign(Object.assign({}, options.conditions), {\n          ifTags: (_f = options.conditions) === null || _f === void 0 ? void 0 : _f.tagConditions\n        })\n      }, convertTracingToRequestOptionsBase(updatedOptions)));\n    } catch (e) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n  /**\n   * To renew the lease.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param options - Optional option to configure lease management operations.\n   * @returns Response data for renew lease operation.\n   */\n\n\n  async renewLease() {\n    let options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    var _a, _b, _c, _d, _e, _f;\n\n    const {\n      span,\n      updatedOptions\n    } = createSpan(\"BlobLeaseClient-renewLease\", options);\n\n    if (this._isContainer && (((_a = options.conditions) === null || _a === void 0 ? void 0 : _a.ifMatch) && ((_b = options.conditions) === null || _b === void 0 ? void 0 : _b.ifMatch) !== ETagNone || ((_c = options.conditions) === null || _c === void 0 ? void 0 : _c.ifNoneMatch) && ((_d = options.conditions) === null || _d === void 0 ? void 0 : _d.ifNoneMatch) !== ETagNone || ((_e = options.conditions) === null || _e === void 0 ? void 0 : _e.tagConditions))) {\n      throw new RangeError(\"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\");\n    }\n\n    try {\n      return await this._containerOrBlobOperation.renewLease(this._leaseId, Object.assign({\n        abortSignal: options.abortSignal,\n        modifiedAccessConditions: Object.assign(Object.assign({}, options.conditions), {\n          ifTags: (_f = options.conditions) === null || _f === void 0 ? void 0 : _f.tagConditions\n        })\n      }, convertTracingToRequestOptionsBase(updatedOptions)));\n    } catch (e) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n  /**\n   * To end the lease but ensure that another client cannot acquire a new lease\n   * until the current lease period has expired.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param breakPeriod - Break period\n   * @param options - Optional options to configure lease management operations.\n   * @returns Response data for break lease operation.\n   */\n\n\n  async breakLease(breakPeriod) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var _a, _b, _c, _d, _e, _f;\n\n    const {\n      span,\n      updatedOptions\n    } = createSpan(\"BlobLeaseClient-breakLease\", options);\n\n    if (this._isContainer && (((_a = options.conditions) === null || _a === void 0 ? void 0 : _a.ifMatch) && ((_b = options.conditions) === null || _b === void 0 ? void 0 : _b.ifMatch) !== ETagNone || ((_c = options.conditions) === null || _c === void 0 ? void 0 : _c.ifNoneMatch) && ((_d = options.conditions) === null || _d === void 0 ? void 0 : _d.ifNoneMatch) !== ETagNone || ((_e = options.conditions) === null || _e === void 0 ? void 0 : _e.tagConditions))) {\n      throw new RangeError(\"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\");\n    }\n\n    try {\n      const operationOptions = Object.assign({\n        abortSignal: options.abortSignal,\n        breakPeriod,\n        modifiedAccessConditions: Object.assign(Object.assign({}, options.conditions), {\n          ifTags: (_f = options.conditions) === null || _f === void 0 ? void 0 : _f.tagConditions\n        })\n      }, convertTracingToRequestOptionsBase(updatedOptions));\n      return await this._containerOrBlobOperation.breakLease(operationOptions);\n    } catch (e) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n\n}","map":{"version":3,"sources":["../../../src/BlobLeaseClient.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\nimport { generateUuid, HttpResponse } from \"@azure/core-http\";\nimport { StorageClientContext } from \"./generated/src/index\";\nimport { ContainerBreakLeaseOptionalParams } from \"./generatedModels\";\nimport { AbortSignalLike } from \"@azure/abort-controller\";\nimport { SpanStatusCode } from \"@azure/core-tracing\";\nimport { Blob as StorageBlob, Container } from \"./generated/src/operations\";\nimport { ModifiedAccessConditions } from \"./models\";\nimport { CommonOptions } from \"./StorageClient\";\nimport { ETagNone } from \"./utils/constants\";\nimport { convertTracingToRequestOptionsBase, createSpan } from \"./utils/tracing\";\nimport { BlobClient } from \"./Clients\";\nimport { ContainerClient } from \"./ContainerClient\";\n\n/**\n * The details for a specific lease.\n */\nexport interface Lease {\n  /**\n   * The ETag contains a value that you can use to\n   * perform operations conditionally. If the request version is 2011-08-18 or\n   * newer, the ETag value will be in quotes.\n   */\n  etag?: string;\n  /**\n   * Returns the date and time the container was\n   * last modified. Any operation that modifies the blob, including an update\n   * of the blob's metadata or properties, changes the last-modified time of\n   * the blob.\n   */\n  lastModified?: Date;\n  /**\n   * Uniquely identifies a container's lease\n   */\n  leaseId?: string;\n  /**\n   * Approximate time remaining in the lease\n   * period, in seconds.\n   */\n  leaseTime?: number;\n  /**\n   * This header uniquely identifies the request\n   * that was made and can be used for troubleshooting the request.\n   */\n  requestId?: string;\n  /**\n   * Indicates the version of the Blob service used\n   * to execute the request. This header is returned for requests made against\n   * version 2009-09-19 and above.\n   */\n  version?: string;\n  /**\n   * UTC date/time value generated by the service that\n   * indicates the time at which the response was initiated\n   */\n  date?: Date;\n  /**\n   * Error code if any associated with the response that returned\n   * the Lease information.\n   */\n  errorCode?: string;\n}\n\n/**\n * Contains the response data for operations that create, modify, or delete a lease.\n *\n * See {@link BlobLeaseClient}.\n */\nexport type LeaseOperationResponse = Lease & {\n  /**\n   * The underlying HTTP response.\n   */\n  _response: HttpResponse & {\n    /**\n     * The parsed HTTP response headers.\n     */\n    parsedHeaders: Lease;\n  };\n};\n\n/**\n * Configures lease operations.\n */\nexport interface LeaseOperationOptions extends CommonOptions {\n  /**\n   * An implementation of the `AbortSignalLike` interface to signal the request to cancel the operation.\n   * For example, use the &commat;azure/abort-controller to create an `AbortSignal`.\n   */\n  abortSignal?: AbortSignalLike;\n  /**\n   * Conditions to meet when changing the lease.\n   */\n  conditions?: ModifiedAccessConditions;\n}\n\n/**\n * A client that manages leases for a {@link ContainerClient} or a {@link BlobClient}.\n */\nexport class BlobLeaseClient {\n  private _leaseId: string;\n  private _url: string;\n  private _containerOrBlobOperation: Container | StorageBlob;\n  private _isContainer: boolean;\n\n  /**\n   * Gets the lease Id.\n   *\n   * @readonly\n   */\n  public get leaseId(): string {\n    return this._leaseId;\n  }\n\n  /**\n   * Gets the url.\n   *\n   * @readonly\n   */\n  public get url(): string {\n    return this._url;\n  }\n\n  /**\n   * Creates an instance of BlobLeaseClient.\n   * @param client - The client to make the lease operation requests.\n   * @param leaseId - Initial proposed lease id.\n   */\n  constructor(client: ContainerClient | BlobClient, leaseId?: string) {\n    const clientContext = new StorageClientContext(\n      client.url,\n      (client as any).pipeline.toServiceClientOptions()\n    );\n    this._url = client.url;\n\n    if ((client as BlobClient).name === undefined) {\n      this._isContainer = true;\n      this._containerOrBlobOperation = new Container(clientContext);\n    } else {\n      this._isContainer = false;\n      this._containerOrBlobOperation = new StorageBlob(clientContext);\n    }\n\n    if (!leaseId) {\n      leaseId = generateUuid();\n    }\n    this._leaseId = leaseId;\n  }\n\n  /**\n   * Establishes and manages a lock on a container for delete operations, or on a blob\n   * for write and delete operations.\n   * The lock duration can be 15 to 60 seconds, or can be infinite.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param duration - Must be between 15 to 60 seconds, or infinite (-1)\n   * @param options - option to configure lease management operations.\n   * @returns Response data for acquire lease operation.\n   */\n  public async acquireLease(\n    duration: number,\n    options: LeaseOperationOptions = {}\n  ): Promise<LeaseOperationResponse> {\n    const { span, updatedOptions } = createSpan(\"BlobLeaseClient-acquireLease\", options);\n\n    if (\n      this._isContainer &&\n      ((options.conditions?.ifMatch && options.conditions?.ifMatch !== ETagNone) ||\n        (options.conditions?.ifNoneMatch && options.conditions?.ifNoneMatch !== ETagNone) ||\n        options.conditions?.tagConditions)\n    ) {\n      throw new RangeError(\n        \"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\"\n      );\n    }\n\n    try {\n      return await this._containerOrBlobOperation.acquireLease({\n        abortSignal: options.abortSignal,\n        duration,\n        modifiedAccessConditions: {\n          ...options.conditions,\n          ifTags: options.conditions?.tagConditions,\n        },\n        proposedLeaseId: this._leaseId,\n        ...convertTracingToRequestOptionsBase(updatedOptions),\n      });\n    } catch (e: any) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message,\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n\n  /**\n   * To change the ID of the lease.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param proposedLeaseId - the proposed new lease Id.\n   * @param options - option to configure lease management operations.\n   * @returns Response data for change lease operation.\n   */\n  public async changeLease(\n    proposedLeaseId: string,\n    options: LeaseOperationOptions = {}\n  ): Promise<LeaseOperationResponse> {\n    const { span, updatedOptions } = createSpan(\"BlobLeaseClient-changeLease\", options);\n\n    if (\n      this._isContainer &&\n      ((options.conditions?.ifMatch && options.conditions?.ifMatch !== ETagNone) ||\n        (options.conditions?.ifNoneMatch && options.conditions?.ifNoneMatch !== ETagNone) ||\n        options.conditions?.tagConditions)\n    ) {\n      throw new RangeError(\n        \"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\"\n      );\n    }\n\n    try {\n      const response = await this._containerOrBlobOperation.changeLease(\n        this._leaseId,\n        proposedLeaseId,\n        {\n          abortSignal: options.abortSignal,\n          modifiedAccessConditions: {\n            ...options.conditions,\n            ifTags: options.conditions?.tagConditions,\n          },\n          ...convertTracingToRequestOptionsBase(updatedOptions),\n        }\n      );\n      this._leaseId = proposedLeaseId;\n      return response;\n    } catch (e: any) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message,\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n\n  /**\n   * To free the lease if it is no longer needed so that another client may\n   * immediately acquire a lease against the container or the blob.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param options - option to configure lease management operations.\n   * @returns Response data for release lease operation.\n   */\n  public async releaseLease(options: LeaseOperationOptions = {}): Promise<LeaseOperationResponse> {\n    const { span, updatedOptions } = createSpan(\"BlobLeaseClient-releaseLease\", options);\n\n    if (\n      this._isContainer &&\n      ((options.conditions?.ifMatch && options.conditions?.ifMatch !== ETagNone) ||\n        (options.conditions?.ifNoneMatch && options.conditions?.ifNoneMatch !== ETagNone) ||\n        options.conditions?.tagConditions)\n    ) {\n      throw new RangeError(\n        \"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\"\n      );\n    }\n\n    try {\n      return await this._containerOrBlobOperation.releaseLease(this._leaseId, {\n        abortSignal: options.abortSignal,\n        modifiedAccessConditions: {\n          ...options.conditions,\n          ifTags: options.conditions?.tagConditions,\n        },\n        ...convertTracingToRequestOptionsBase(updatedOptions),\n      });\n    } catch (e: any) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message,\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n\n  /**\n   * To renew the lease.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param options - Optional option to configure lease management operations.\n   * @returns Response data for renew lease operation.\n   */\n  public async renewLease(options: LeaseOperationOptions = {}): Promise<Lease> {\n    const { span, updatedOptions } = createSpan(\"BlobLeaseClient-renewLease\", options);\n\n    if (\n      this._isContainer &&\n      ((options.conditions?.ifMatch && options.conditions?.ifMatch !== ETagNone) ||\n        (options.conditions?.ifNoneMatch && options.conditions?.ifNoneMatch !== ETagNone) ||\n        options.conditions?.tagConditions)\n    ) {\n      throw new RangeError(\n        \"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\"\n      );\n    }\n\n    try {\n      return await this._containerOrBlobOperation.renewLease(this._leaseId, {\n        abortSignal: options.abortSignal,\n        modifiedAccessConditions: {\n          ...options.conditions,\n          ifTags: options.conditions?.tagConditions,\n        },\n        ...convertTracingToRequestOptionsBase(updatedOptions),\n      });\n    } catch (e: any) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message,\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n\n  /**\n   * To end the lease but ensure that another client cannot acquire a new lease\n   * until the current lease period has expired.\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-container\n   * and\n   * @see https://docs.microsoft.com/en-us/rest/api/storageservices/lease-blob\n   *\n   * @param breakPeriod - Break period\n   * @param options - Optional options to configure lease management operations.\n   * @returns Response data for break lease operation.\n   */\n  public async breakLease(\n    breakPeriod: number,\n    options: LeaseOperationOptions = {}\n  ): Promise<LeaseOperationResponse> {\n    const { span, updatedOptions } = createSpan(\"BlobLeaseClient-breakLease\", options);\n\n    if (\n      this._isContainer &&\n      ((options.conditions?.ifMatch && options.conditions?.ifMatch !== ETagNone) ||\n        (options.conditions?.ifNoneMatch && options.conditions?.ifNoneMatch !== ETagNone) ||\n        options.conditions?.tagConditions)\n    ) {\n      throw new RangeError(\n        \"The IfMatch, IfNoneMatch and tags access conditions are ignored by the service. Values other than undefined or their default values are not acceptable.\"\n      );\n    }\n\n    try {\n      const operationOptions: ContainerBreakLeaseOptionalParams = {\n        abortSignal: options.abortSignal,\n        breakPeriod,\n        modifiedAccessConditions: {\n          ...options.conditions,\n          ifTags: options.conditions?.tagConditions,\n        },\n        ...convertTracingToRequestOptionsBase(updatedOptions),\n      };\n      return await this._containerOrBlobOperation.breakLease(operationOptions);\n    } catch (e: any) {\n      span.setStatus({\n        code: SpanStatusCode.ERROR,\n        message: e.message,\n      });\n      throw e;\n    } finally {\n      span.end();\n    }\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}